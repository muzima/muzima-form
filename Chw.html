<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/muzima.css" rel="stylesheet">
    <link href="css/ui-darkness/jquery-ui-1.10.4.custom.min.css" rel="stylesheet">
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-ui-1.10.4.custom.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/additional-methods.min.js"></script>
    <script src="js/muzima.js"></script>

    <title>CDM CHW Form v 0.01</title>
</head>

<body class="col-md-10 col-md-offset-1">
<div id="pre_populate_data"></div>
<h2 class="text-center">CDM CHW Form v 0.01</h2>

<form id="chw_form" name="chw_form">

<div class="section">
    <h3>Demographics</h3>

    <div class="form-group">
        <input class="form-control" id="patient.uuid" name="patient.uuid" type="hidden" readonly="readonly">
    </div>
    <div class="form-group">
        <label for="patient.medical_record_number">AMRS ID Number:</label>
        <input class="form-control" id="patient.medical_record_number" name="patient.medical_record_number" type="text"
               readonly="readonly" disabled="disabled">
    </div>
    <div class="form-group">
    <label for="patient.family_name">Family Name:</label>
        <input class="form-control" id="patient.family_name" name="patient.family_name" type="text" readonly="readonly"
               disabled="disabled">
    </div>
    <div class="form-group">
        <label for="patient.given_name">Given Name:</label>
        <input class="form-control" id="patient.given_name" name="patient.given_name" type="text" readonly="readonly"
               disabled="disabled">
    </div>
    <div class="form-group">
        <label for="patient.middle_name">Middle Name:</label>
        <input class="form-control" id="patient.middle_name" name="patient.middle_name" type="text" readonly="readonly"
               disabled="disabled">
    </div>
    <div class="form-group">
        <label for="patient.sex">Gender:</label>
        <select class="form-control" id="patient.sex" name="patient.sex" disabled="disabled">
            <option value="">...</option>
            <option value="M">Male</option>
            <option value="F">Female</option>
        </select>
    </div>
    <div class="form-group">
        <label for="patient.birthdate">Date Of Birth:</label>
        <input class="form-control" id="patient.birthdate" name="patient.birthdate" type="text"
               readonly="readonly" disabled="disabled">
    </div>
</div>

<div class="section">
    <div class="form-group">
        <label for="encounter.location_id">Encounter Location:<span class="required">*</span></label>
        <select class="form-control" name="encounter.location_id" id="encounter.location_id" required="required">
            <option value="">...</option>
            <option value="9">Ampath MTRH</option>
            <option value="7">Chulaimbo</option>
            <option value="17">Iten</option>
            <option value="2">Mosoriot</option>
            <option value="3">Turbo</option>
            <option value="8">Webuye</option>
        </select>
    </div>

    <div class="form-group">
        <label for="encounter.encounter_datetime">
            Encounter Date:<span class="required">*</span>
        </label>
        <input class="form-control datepicker nonFutureDate past-date" id="encounter.encounter_datetime"
               name="encounter.encounter_datetime" type="text" readonly="readonly"
               required="required">
    </div>
    <div class="form-group">
        <input class="form-control" id="encounter.form_uuid" name="encounter.form_uuid" type="hidden"
               required="required">
    </div>
</div>

<div class="section hidden">
    <div class="form-group">
        <label for="previous_follow_up">Previous date this form was filled:</label>
        <input class="form-control datepicker nonFutureDate past-date" id="previous_follow_up"
               name="previous_follow_up" type="text" readonly="readonly"
               data-concept="9167^DATE OF LAST FOLLOW-UP^99DCT">
    </div>
    <div class="form-group">
        <label for="missed_appointment_date">Missed appointment date:</label>
        <input class="form-control datepicker nonFutureDate past-date" id="missed_appointment_date"
               name="missed_appointment_date" type="text" readonly="readonly"
               data-concept="1592^MISSED APPOINTMENT DATE^99DCT">
    </div>
</div>

<div class="section hidden">
    <h4>PHCT Blood Sugar Readings</h4>

    <div class="form-group">
        <label for="random_blood_sugar">Random blood sugar (RBS):</label>

        <div class="input-group">
            <input class="form-control" id="random_blood_sugar"
                   name="random_blood_sugar" type="number"
                   data-concept="887^SERUM GLUCOSE^99DCT">
            <span class="input-group-addon">mmol/L</span>
        </div>
    </div>
    <div class="form-group">
        <label for="fasting_blood_sugar">Fasting blood sugar (FBS):</label>

        <div class="input-group">
            <input class="form-control" id="fasting_blood_sugar"
                   name="fasting_blood_sugar" type="number"
                   data-concept="6252^SERUM GLUCOSE, FASTING^99DCT">
            <span class="input-group-addon">mmol/L</span>
        </div>
    </div>
</div>

<div class="section hidden">
    <h4>PHCT Blood Pressure Readings</h4>

    <div class="form-group">
        <label for="systolic_blood_pressure">Systolic blood pressure:</label>

        <div class="input-group">
            <input class="form-control" id="systolic_blood_pressure"
                   name="systolic_blood_pressure" type="number"
                   data-concept="5085^SYSTOLIC BLOOD PRESSURE^99DCT">
            <span class="input-group-addon">mmHg</span>
        </div>
    </div>
    <div class="form-group">
        <label for="diastolic_blood_pressure">Diastolic blood pressure:</label>

        <div class="input-group">
            <input class="form-control" id="diastolic_blood_pressure"
                   name="diastolic_blood_pressure" type="number"
                   data-concept="5086^DIASTOLIC BLOOD PRESSURE^99DCT">
            <span class="input-group-addon">mmHg</span>
        </div>
    </div>
</div>

<div class="section hidden" data-concept="1932^REFERRALS ORDERED, DETAILED^99DCT">
    <div class="form-group">
        <label for="referrals_ordered">Name of facility client was referred to:</label>
        <input class="form-control" id="referrals_ordered"
               name="referrals_ordered" type="text"
               data-concept="1272^REFERRALS ORDERED^99DCT">
    </div>
</div>

<div class="section hidden">
    <div class="form-group">
        <label for="date_referred">Date referred:</label>
        <input class="form-control datepicker nonFutureDate past-date" id="date_referred"
               name="date_referred" type="text" readonly="readonly"
               data-concept="9158^DATE REFERRED^99DCT">
    </div>
</div>

<div class="section" data-concept="6750^REFERRED BY, DETAILED^99DCT">
    <h4>Client referred from:<span class="required">*</span></h4>

    <fieldset name="6749^REFERRED BY^99DCT">
        <div class="form-group">
            <label class="font-normal">
                <input id="referred_by.phct" type="checkbox"
                       data-concept="6749^REFERRED BY^99DCT"
                       value="8227^PHCT^99DCT">
                PHCT
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input id="referred_by.mch" type="checkbox"
                       data-concept="6749^REFERRED BY^99DCT"
                       value="2050^MATERNAL CHILD HEALTH PROGRAM^99DCT">
                MCH
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input id="referred_by.clinic" type="checkbox"
                       data-concept="6749^REFERRED BY^99DCT"
                       value="7037^REFERRED FROM CLINIC^99DCT">
                Clinic
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input class="has-freetext" id="referred_by.other_non_coded" type="checkbox"
                       data-concept="6749^REFERRED BY^99DCT"
                       value="5622^OTHER NON-CODED^99DCT">
                Other
            </label>
        </div>
        <div class="form-group freetext">
            <label for="referred_by.freetext_general">Specify<span class="required">*</span></label>
            <input class="form-control" id="referred_by.freetext_general"
                   name="referred_by.freetext_general" type="text"
                   data-concept="1915^FREETEXT GENERAL^99DCT">
        </div>
    </fieldset>
</div>

<div class="section" data-concept="9168^TYPE OF FOLLOW-UP, DETAILED^99DCT">
    <h4>Type of CHW follow up:<span class="required">*</span></h4>

    <fieldset name="2332^TYPE OF FOLLOW-UP^99DCT">
        <div class="form-group">
            <label class="font-normal">
                <input id="follow_up_type.hypertension" type="checkbox"
                       data-concept="2332^TYPE OF FOLLOW-UP^99DCT"
                       value="7286^KNOWN HYPERTENSIVE PATIENT^99DCT">
                Hypertension
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input id="follow_up_type.diabetic" type="checkbox"
                       data-concept="2332^TYPE OF FOLLOW-UP^99DCT"
                       value="7282^KNOWN DIABETIC PATIENT^99DCT">
                Diabetic
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input class="has-freetext" id="follow_up_type.other_non_coded" type="checkbox"
                       data-concept="2332^TYPE OF FOLLOW-UP^99DCT"
                       value="5622^OTHER NON-CODED^99DCT">
                Other
            </label>
        </div>
        <div class="form-group freetext">
            <label for="follow_up_type.freetext_general">Specify<span class="required">*</span></label>
            <input class="form-control" id="follow_up_type.freetext_general"
                   name="follow_up_type.freetext_general" type="text" required="required"
                   data-concept="1915^FREETEXT GENERAL^99DCT">
        </div>
    </fieldset>
</div>

<div class="section" data-concept="6114^REASON FOR ATTEMPTED CONTACT, DETAILED^99DCT">
    <h4>Reason for follow up:<span class="required">*</span></h4>

    <fieldset name="9081^PATIENT ON OUTREACH FOLLOW-UP CATEGORY^99DCT">
        <div class="form-group">
            <label class="font-normal">
                <input id="follow_up_category.not_linked_to_care" type="checkbox"
                       data-concept="9081^PATIENT ON OUTREACH FOLLOW-UP CATEGORY^99DCT"
                       value="9160^NOT LINKED TO CARE^99DCT">
                Not linked to care
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input id="follow_up_category.lost_to_follow_up" type="checkbox"
                       data-concept="9081^PATIENT ON OUTREACH FOLLOW-UP CATEGORY^99DCT"
                       value="9159^LOST TO FOLLOW-UP, NOS^99DCT">
                Lost to follow up
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input class="has-freetext" id="follow_up_category.other_non_coded" type="checkbox"
                       data-concept="9081^PATIENT ON OUTREACH FOLLOW-UP CATEGORY^99DCT"
                       value="5622^OTHER NON-CODED^99DCT">
                Other
            </label>
        </div>
        <div class="form-group freetext">
            <label for="follow_up_category.freetext_general">Specify<span class="required">*</span></label>
            <input class="form-control" id="follow_up_category.freetext_general"
                   name="follow_up_category.freetext_general" type="text" required="required"
                   data-concept="1915^FREETEXT GENERAL^99DCT">
        </div>
    </fieldset>
</div>

<div class="section" data-concept="6187^REASON FOR MISSED VISIT, DETAILED^99DCT">
    <h4>Reason for missed appointment:<span class="required">*</span></h4>

    <fieldset name="1733^REASON FOR MISSED VISIT^99DCT">
        <div class="form-group">
            <label class="font-normal">
                <input id="missed_visit_reason.lack_of_time" type="checkbox"
                       data-concept="1733^REASON FOR MISSED VISIT^99DCT"
                       value="9148^COMMITMENTS^99DCT">
                Lack of time
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input id="missed_visit_reason.lack_of_money" type="checkbox"
                       data-concept="1733^REASON FOR MISSED VISIT^99DCT"
                       value="6295^FINANCIAL BARRIER^99DCT">
                Lack of money
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input id="missed_visit_reason.lack_of_confidence" type="checkbox"
                       data-concept="1733^REASON FOR MISSED VISIT^99DCT"
                       value="9161^LACK OF CONFIDENCE^99DCT">
                Lack of confidence in health care worker(s)
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input id="missed_visit_reason.lack_of_transport" type="checkbox"
                       data-concept="1733^REASON FOR MISSED VISIT^99DCT"
                       value="820^TRANSPORT PROBLEMS^99DCT">
                Lack of transport
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input id="missed_visit_reason.asymptomatic" type="checkbox"
                       data-concept="1733^REASON FOR MISSED VISIT^99DCT"
                       value="5006^ASYMPTOMATIC^99DCT">
                No symptoms of illness
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input id="missed_visit_reason.visited_not_seen" type="checkbox"
                       data-concept="1733^REASON FOR MISSED VISIT^99DCT"
                       value="9162^VISITED HEALTH CARE FACILITY, NOT SEEN^99DCT">
                Visited not seen
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input id="missed_visit_reason.visited_dispensary_closed" type="checkbox"
                       data-concept="1733^REASON FOR MISSED VISIT^99DCT"
                       value="9163^VISITED HEALTH CARE FACILITY, CLOSED^99DCT">
                Visited dispensary closed
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input id="missed_visit_reason.distance_too_far" type="checkbox"
                       data-concept="1733^REASON FOR MISSED VISIT^99DCT"
                       value="1551^DISTANCE TOO FAR^99DCT">
                Distance (too far)
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input id="missed_visit_reason.sought_care_elsewhere" type="checkbox"
                       data-concept="1733^REASON FOR MISSED VISIT^99DCT"
                       value="8352^CONTINUE TO RECEIVE MEDICATIONS FROM ANOTHER LOCATION^99DCT">
                Sought care elsewhere
            </label>
        </div>
        <div class="form-group">
            <label class="font-normal">
                <input class="has-freetext" id="missed_visit_reason.other_non_coded" type="checkbox"
                       data-concept="1733^REASON FOR MISSED VISIT^99DCT"
                       value="5622^OTHER NON-CODED^99DCT">
                Other
            </label>
        </div>
        <div class="form-group freetext">
            <label for="missed_visit_reason.freetext_general">Specify<span class="required">*</span></label>
            <input class="form-control" id="missed_visit_reason.freetext_general"
                   name="missed_visit_reason.freetext_general" type="text" required="required"
                   data-concept="1915^FREETEXT GENERAL^99DCT">
        </div>
    </fieldset>
</div>

<div class="section">
    <div class="form-group">
        <span><strong>Are you currently on any treatment/ medication?<span class="required">*</span></strong></span>

        <fieldset name="1193^CURRENT MEDICATIONS^99DCT">
            <div class="form-group">
                <label class="font-normal">
                    <input name="currently_on_medication" type="radio"
                           data-concept="1193^CURRENT MEDICATIONS^99DCT"
                           value="1065^YES^99DCT">
                    Yes
                </label>
            </div>
            <div class="form-group">
                <label class="font-normal">
                    <input name="currently_on_medication" type="radio"
                           data-concept="1193^CURRENT MEDICATIONS^99DCT"
                           value="1066^NO^99DCT">
                    No
                </label>
            </div>
        </fieldset>
    </div>
    <div class="custom-repeat hidden current-medication" id="current-medication" data-name="current_medication">
        <div class="form-group">
            <label>Specify the medication:<span class="required">*</span></label>
            <input class="form-control current_medication" name="current_medication" type="text"
                   data-concept="1193^CURRENT MEDICATIONS^99DCT^1">
        </div>
    </div>
</div>

<div class="section">
    <div class="form-group">
        <span><strong>Are you enrolled to care in another facility?<span class="required">*</span></strong></span>

        <fieldset name="9164^ENROLL CARE IN ANOTHER HEALTH FACILITY^99DCT">
            <div class="form-group">
                <label class="font-normal">
                    <input name="enrolled_in_other" type="radio"
                           data-concept="9164^ENROLL CARE IN ANOTHER HEALTH FACILITY^99DCT"
                           value="1065^YES^99DCT">
                    Yes
                </label>
            </div>
            <div class="form-group">
                <label class="font-normal">
                    <input name="enrolled_in_other" type="radio"
                           data-concept="9164^ENROLL CARE IN ANOTHER HEALTH FACILITY^99DCT"
                           value="1066^NO^99DCT">
                    No
                </label>
            </div>
        </fieldset>
    </div>
    <div class="form-group hidden">
        <label for="current_facility">If enrolled in another facility, where?<span class="required">*</span></label>
        <input class="form-control" id="current_facility"
               name="current_facility" type="text" required="required"
               data-concept="9165^NAME OF FACILITY TO WHICH PATIENT IS ENROLLED^99DCT">
    </div>
    <div class="form-group hidden">
        <span><strong>If No, are you planning to resume care?<span class="required">*</span></strong></span>

        <fieldset name="6140^PLAN TO RETURN TO CLINIC^99DCT">
            <div class="form-group">
                <label class="font-normal">
                    <input name="planning_to_resume" type="radio"
                           data-concept="6140^PLAN TO RETURN TO CLINIC^99DCT"
                           value="1065^YES^99DCT">
                    Yes
                </label>
            </div>
            <div class="form-group">
                <label class="font-normal">
                    <input name="planning_to_resume" type="radio"
                           data-concept="6140^PLAN TO RETURN TO CLINIC^99DCT"
                           value="1066^NO^99DCT">
                    No
                </label>
            </div>
        </fieldset>
    </div>
    <div class="form-group hidden">
        <label for="resume_care_date">If planning to resume care, when?<span class="required">*</span></label>
        <input class="form-control datepicker checkFutureDate future-date" id="resume_care_date"
               name="resume_care_date" type="text" required="required" readonly="readonly"
               data-concept="7348^RETURN VISIT DATE, DISPENSARY^99DCT">
    </div>
    <div class="concept-set form-group hidden" data-concept="9087^FACILITY TYPE, DETAILED^99DCT">
        <label for="resume_care_facility">Which facility?<span class="required">*</span></label>
        <input class="form-control" id="resume_care_facility"
               name="resume_care_facility" type="text" required="required"
               data-concept="9086^FACILITY TYPE^99DCT">
    </div>
</div>

<div class="section">
    <div class="form-group">
        <label for="referred_to">Referred to?<span class="required">*</span></label>
        <input class="form-control" id="referred_to"
               name="referred_to" type="text" required="required"
               data-concept="7637^NAME OF FACILITY TO WHICH PATIENT IS REFERRED, FREETEXT^99DCT">
    </div>
    <div class="form-group">
        <label for="referred_to_date">Date:<span class="required">*</span></label>
        <input class="form-control datepicker checkFutureDate future-date" id="referred_to_date"
               name="referred_to_date" type="text" required="required"
               data-concept="5096^RETURN VISIT DATE^99DCT" readonly="readonly">
    </div>
    <div class="form-group">
        <label for="planned_follow_up_date">Planned CHW follow up date?<span class="required">*</span></label>
        <input class="form-control datepicker checkFutureDate future-date" id="planned_follow_up_date"
               name="planned_follow_up_date" type="text" required="required"
               data-concept="9166^PLANNED FOLLOW-UP DATE^99DCT" readonly="readonly">
    </div>
</div>

<div class="section">
    <div class="form-group">
        <label for="encounter.provider_id_select">Provider Name:</label>
        <input class="form-control valid-provider-only" id="encounter.provider_id_select" type="text"
               placeholder="Start typing provider name here ...">
        <input class="form-control" name="encounter.provider_id_select" type="hidden">
    </div>

    <div class="form-group hidden">
        <select id="select_providers">
            <option data-provider = "Ann Githua" value = "3762-2">Ann Githua</option>
            <option data-provider = "Faith Bargoiyet" value = "3854-7">Faith Bargoiyet</option>
            <option data-provider = "Jackline Chemeli Chebii" value = "3853-9">Jackline Chemeli Chebii</option>
            <option data-provider = "Lydia Jepkoech" value = "1830-9">Lydia Jepkoech</option>
            <option data-provider = "Peter Onditi" value = "3760-6">Peter Onditi</option>
            <option data-provider = "Valentine Jeptoo Kimisoi" value = "3855-4">Valentine Jeptoo Kimisoi</option>
            <option data-provider = "Viola Boitt" value = "3766-3">Viola Boitt</option>
            <option data-provider = "Philip Kiprop Rutto" value = "3764-8">Philip Kiprop Rutto</option>
            <option data-provider = "Carolyne Sambaya Kiptoo" value = "3755-6">Carolyne Sambaya Kiptoo</option>
            <option data-provider = "Alice Bor" value = "3756-4">Alice Bor</option>
            <option data-provider = "John Kitur" value = "3768-9">John Kitur</option>
            <option data-provider = "Isaiah Rono Kemei" value = "3851-3">Isaiah Rono Kemei</option>
            <option data-provider = "Musa Mugungei" value = "3851-3">Musa Mugungei</option>
            <option data-provider = "Daurine Achieng Agumba" value = "3419-9">Daurine Achieng Agumba</option>
            <option data-provider = "Irene Chepkosgei	Kurgat" value = "3420-7">Irene Chepkosgei	Kurgat</option>
            <option data-provider = "Rose	Cheruto	Toroitich" value = "3421-5">Rose	Cheruto	Toroitich</option>
            <option data-provider = "Mary	Kipkurui Kimosop" value = "3422-3">Mary	Kipkurui Kimosop</option>
            <option data-provider = "Jacqueline Chemom Ndiema" value = "3423-1">Jacqueline Chemom Ndiema</option>
            <option data-provider = "Grace Wanjiru Mwangi" value = "3424-9">Grace Wanjiru Mwangi</option>
            <option data-provider = "Collette	Mabia Palapala" value = "3425-6">Collette	Mabia Palapala</option>
            <option data-provider = "Dorice Erima	Wekesa	Female" value = "3426-4">Dorice Erima	Wekesa	Female</option>
            <option data-provider = "Agnes Kagure	Boen" value = "120-6">Agnes Kagure	Boen</option>
            <option data-provider = "Linet Kerubo	Onyancha" value = "3427-2">Linet Kerubo	Onyancha</option>
            <option data-provider = "Delinah Muchai Tanui" value = "1208-8">Delinah Muchai Tanui</option>
            <option data-provider = "Hellen Mushimbi Indumbwe" value = "1208-8">Hellen Mushimbi Indumbwe</option>
            <option data-provider = "Lydia Cherugut Samoei" value = "1525-5">Lydia Cherugut Samoei</option>
            <option data-provider = "Ruth	Kalunda	Nzili" value = "1529-7">Ruth	Kalunda	Nzili</option>
            <option data-provider = "Lucy	Cheruto	Birgen" value = "3428-0">Lucy	Cheruto	Birgen</option>
            <option data-provider = "Gratiah Nafuna Khaemba" value = "1409-2">Gratiah Nafuna Khaemba</option>
            <option data-provider = "Leonida Chemutai	Mengich" value = "1357-3">Leonida Chemutai	Mengich</option>
            <option data-provider = "Ann Wangoi Maina" value = "1412-6">Ann Wangoi Maina</option>
            <option data-provider = "Elkanah Omenge Orango" value = "1474-6">Elkanah Omenge Orango</option>
            <option data-provider = "Peter Mukhanadale Istura" value = "1478-7">Peter Mukhanadale Istura</option>
            <option data-provider = "Hillary Mabeya" value = "1476-1">Hillary Mabeya</option>
            <option data-provider = "Astrid Christoffersen Deb" value = "1237-7">Astrid Christoffersen Deb</option>
            <option data-provider = "Philip Kipkirui Tonui" value = "1485-7">Philip Kipkirui Tonui</option>
        </select>
    </div>
    <div class="form-group show_provider_id_text">
        <label for="encounter.provider_id">Enter provider's system-id:<span class="required">*</span></label>
        <input class="form-control checkDigit" id="encounter.provider_id" name="encounter.provider_id" type="text"
               placeholder="Or enter the provider system id here ..." required="required">
    </div>
</div>
</form>
</body>
<script type="text/javascript">

$(document).ready(function () {

    var dateFormat = "dd-mm-yy";
    var currentDate = $.datepicker.formatDate(dateFormat, new Date());
    var encounterDatetime = $('#encounter\\.encounter_datetime');
    if ($(encounterDatetime).val() == "") {
        $(encounterDatetime).val(currentDate);
    }

    $('#save_draft').click(function () {
        // pre process the medications
        $(this).prop('disabled', true);
        document.saveDraft(this);
        $(this).prop('disabled', false);
    });

    $('#submit_form').click(function () {
        // pre process the medications
        $(this).prop('disabled', true);
        document.submit();
        $(this).prop('disabled', false);
    });

    var locationName = [
        {"val": "7", "label": "Chulaimbo"},
        {"val": "3", "label": "Turbo"},
        {"val": "17", "label": "Iten"},
        {"val": "2", "label": "Mosoriot"},
        {"val": "8", "label": "Webuye"},
        {"val": "9", "label": "Ampath MTRH"}
    ];

    document.setupAutoComplete('encounter\\.location_id',locationName);


    document.setupAutoCompleteDataForProvider('encounter\\.provider_id_select');


    $('#encounter\\.provider_id_select').change(function () {
        if ($('#encounter\\.provider_id_select').val() === '') {
            $('#encounter\\.provider_id').val('');
            $('.show_provider_id_text').show();
        }
    });

    $('#chw_form').validate({});

    /* Start - Toggle free text element */
    var $hasOther = $('.has-freetext');
    $hasOther.change(function () {
        var $freetext = $(this).closest('.section').find('.freetext');
        if ($(this).is(':checkbox')) {
            if ($(this).is(':checked')) {
                $freetext.show();
            } else {
                $freetext.hide();
            }
        }
    });
    $hasOther.trigger('change');
    /* End - Toggle free text element */

    /* Start - Toggle medications */
    var $onMedication = $(':radio[data-concept="1193^CURRENT MEDICATIONS^99DCT"]');
    $onMedication.change(function () {
        var onMedicationValue = $(this).val();
        var $currentMedication = $('input[data-concept="1193^CURRENT MEDICATIONS^99DCT^1"]').closest(".custom-repeat");
        if ($(this).is(':checked')) {
            if (onMedicationValue == '1065^YES^99DCT') {
                $currentMedication.removeClass('hidden');
            } else if (onMedicationValue == '1066^NO^99DCT') {
                $currentMedication.addClass('hidden');
            }
        }
    });
    $onMedication.trigger('change');
    /* End - Toggle medications */

    /* Start - Toggle resume date and facility */
    var RETURN_PLAN_CONCEPT = "6140^PLAN TO RETURN TO CLINIC^99DCT";
    var $resumeCare = $(':radio[data-concept="' + RETURN_PLAN_CONCEPT + '"]');
    $resumeCare.change(function () {
        var resumeCareValue = $(this).val();
        var FACILITY_TYPE_CONCEPT = "9086^FACILITY TYPE^99DCT";
        var RETURN_DISPENSARY_CONCEPT = "7348^RETURN VISIT DATE, DISPENSARY^99DCT";
        var $resumeCareDate = $('input[data-concept="' + RETURN_DISPENSARY_CONCEPT + '"]').closest('.form-group');
        var $resumeCareFacility = $('input[data-concept="' + FACILITY_TYPE_CONCEPT + '"]').closest('.form-group');
        if ($(this).is(':checked')) {
            if (resumeCareValue == '1065^YES^99DCT') {
                $resumeCareDate.removeClass('hidden');
                $resumeCareFacility.removeClass('hidden')
            } else if (resumeCareValue == '1066^NO^99DCT') {
                $resumeCareDate.addClass('hidden');
                $resumeCareFacility.addClass('hidden');
            }
        }
    });
    $resumeCare.trigger('change');
    /* End - Toggle resume date and facility */

    /* Start - Toggle facility */
    var OTHER_FACILITY_CONCEPT = "9164^ENROLL CARE IN ANOTHER HEALTH FACILITY^99DCT";
    var $enrolled = $(':radio[data-concept="' + OTHER_FACILITY_CONCEPT + '"]');
    $enrolled.change(function () {
        var enrolledValue = $(this).val();
        var RETURN_PLAN_CONCEPT = "6140^PLAN TO RETURN TO CLINIC^99DCT";
        var FACILITY_ENROLLED_CONCEPT = "9165^NAME OF FACILITY TO WHICH PATIENT IS ENROLLED^99DCT";
        var $resumeCare = $(':radio[data-concept="' + RETURN_PLAN_CONCEPT + '"]').closest('.form-group');
        var $enrolledFacility = $('input[data-concept="' + FACILITY_ENROLLED_CONCEPT + '"]').closest('.form-group');
        if ($(this).is(':checked')) {
            if (enrolledValue == '1065^YES^99DCT') {
                $resumeCare.find(":radio").prop("checked", false).trigger('change');
                $resumeCare.addClass('hidden');
                $enrolledFacility.removeClass('hidden');
            } else if (enrolledValue == '1066^NO^99DCT') {
                $resumeCare.find(":radio").prop("checked", false).trigger('change');
                $resumeCare.removeClass('hidden');
                $enrolledFacility.addClass('hidden');
            }
        }
    });
    $enrolled.trigger('change');
    /* End - Toggle facility */

    var medications = [
        {"label": "DAPSONE", "value": 92},
        {"label": "STREPTOMYCIN", "value": 438},
        {"label": "MULTIVITAMIN", "value": 461},
        {"label": "ISONIAZID", "value": 656},
        {"label": "ETHAMBUTOL", "value": 745},
        {"label": "FLUCONAZOLE", "value": 747},
        {"label": "RIFAMPICIN ISONIAZID AND PYRAZINAMIDE", "value": 768},
        {"label": "TRIMETHOPRIM AND SULFAMETHOXAZOLE", "value": 916},
        {"label": "NYSTATIN", "value": 919},
        {"label": "UNKNOWN", "value": 1067},
        {"label": "RIFAMPICIN ISONIAZID PYRAZINAMIDE AND ETHAMBUTOL", "value": 1131},
        {"label": "RIFAMPICIN AND ISONIAZID", "value": 1194},
        {"label": "ANTIBIOTICS", "value": 1195},
        {"label": "OTHER NON-CODED", "value": 5622},
        {"label": "ANTIMALARIAL MEDICATIONS", "value": 5839},
        {"label": "HERBAL TRADITIONAL MEDICATIONS", "value": 5841},
        {"label": "MINERALS IRON SUPPLEMENTS", "value": 5843},
        {"label": "NONE", "value": 1107},
        {"label": "RIFAMPICIN ISONIAZID AND ETHAMBUTOL", "value": 2231},
        {"label": "ETHAMBUTOL AND ISONIZAID", "value": 1108},
        {"label": "RIFAMPICIN", "value": 767},
        {"label": "PYRAZINAMIDE", "value": 5829},
        {"label": "NSAIDS", "value": 6476},
        {"label": "DIHYDROCODEINE", "value": 743},
        {"label": "MORPHINE", "value": 6477},
        {"label": "ZIDOVUDINE AND LAMIVUDINE", "value": 630},
        {"label": "STAVUDINE LAMIVUDINE AND NEVIRAPINE", "value": 792},
        {"label": "EMTRICITABINE AND TENOFOVIR", "value": 6180},
        {"label": "NEVIRAPINE", "value": 631},
        {"label": "LAMIVUDINE", "value": 628},
        {"label": "ZIDOVUDINE", "value": 797},
        {"label": "STAVUDINE", "value": 625},
        {"label": "EFAVIRENZ", "value": 633},
        {"label": "ABACAVIR", "value": 814},
        {"label": "LOPINAVIR AND RITONAVIR", "value": 794},
        {"label": "DIDANOSINE", "value": 796},
        {"label": "TENOFOVIR", "value": 802},
        {"label": "INDINAVIR", "value": 749},
        {"label": "RALTEGRAVIR", "value": 6156},
        {"label": "PEDIATRIC RIFAMPICIN ISONIAZID AND PYRAZINAMIDE", "value": 6602},
        {"label": "PEDIATRIC RIFAMPICIN AND ISONIAZID", "value": 6603},
        {"label": "METFORMIN", "value": 2261},
        {"label": "GLIBENCLAMIDE", "value": 2257},
        {"label": "ENALAPRIL", "value": 1242},
        {"label": "HYDROCHLOROTHIAZIDE", "value": 1243},
        {"label": "LOSARTAN", "value": 2265},
        {"label": "NIFEDIPINE", "value": 250},
        {"label": "FLUOXETINE", "value": 2281},
        {"label": "OLANZAPINE", "value": 2282},
        {"label": "ALPRAZOLAM", "value": 733},
        {"label": "AMITRIPTYLINE", "value": 2273},
        {"label": "BENZHEXOL", "value": 7578},
        {"label": "CARBAMAZEPINE", "value": 920},
        {"label": "CHLORPROMAZINE", "value": 914},
        {"label": "FLUPHENAZINE", "value": 927},
        {"label": "HALOPERIDOL", "value": 2283},
        {"label": "IMIPRAMINE", "value": 748},
        {"label": "VALPROATE SODIUM", "value": 2284},
        {"label": "ANTIRETROVIRAL DRUGS", "value": 1085},
        {"label": "VITAMINS", "value": 6339},
        {"label": "MALARIA PROPHYLAXIS", "value": 6338},
        {"label": "IRON SUPPLEMENT", "value": 2363},
        {"label": "FOLIC ACID", "value": 257}
    ];

    /* Start - Custom repeating element */
    $('.custom-repeat')
            .append("<input class='btn btn-primary add-section pull-left' type='button' value='+'/>")
            .append("<input class='btn btn-primary remove-section pull-right' type='button' value='-'/><span class='clear'></span>");

    var enableAutoComplete = function(input) {
        $(input).autocomplete({
            source: medications,
            create: function (event, ui) {
                var value = $(this).val();
                $.each(locationName, function (i, element) {
                    if (element.val == value) {
                        $(this).val(element.label);
                    }
                });
            },
            select: function (event, ui) {
                var selectedValue = ui.item.value + "^" + ui.item.label + "^99DCT";
                $(this).val(selectedValue);
                return false;
            }
        }).focus(function () {
            $(this).find('input').select();
            $(this).select();
        });
    };

    var enableAddSection = function(input) {
        $(input).click(function () {
            var $clonedSection = $(this).parent().clone().insertAfter($(this).parent());
            $clonedSection.find(':input:not(:button)').val('');
            $clonedSection.find(':input:not(:button)').trigger('change');
            enableAddSection($clonedSection.find('.add-section'));
            enableRemoveSection($clonedSection.find('.remove-section'));
            enableAutoComplete($clonedSection.find('.current_medication'));
        });
    };

    var enableRemoveSection = function(input) {
        $(input).click(function () {
            var $parent = $(this).parent();
            var _id = $parent.attr('id');
            if ($("." + _id).length > 1) {
                $parent.remove();
            }
        });
    };

    enableAddSection($('.add-section'));
    enableRemoveSection('.remove-section');
    enableAutoComplete($('.current_medication'));
    /* End - Custom repeating element */

    $.fn.customValidationCheck = function () {
        var referredBy = $('fieldset[name="6749^REFERRED BY^99DCT"]');
        var followUpType = $('fieldset[name="2332^TYPE OF FOLLOW-UP^99DCT"]');
        var clinicVisitPlan = $('fieldset[name="6140^PLAN TO RETURN TO CLINIC^99DCT"]');
        var followUpCategory = $('fieldset[name="9081^PATIENT ON OUTREACH FOLLOW-UP CATEGORY^99DCT"]');
        var missedVisitReason = $('fieldset[name="1733^REASON FOR MISSED VISIT^99DCT"]');
        var currentMedication = $('fieldset[name="1193^CURRENT MEDICATIONS^99DCT"]');
        var enrolled = $('fieldset[name="9164^ENROLL CARE IN ANOTHER HEALTH FACILITY^99DCT"]');
        var errors = $.extend({},
                validateSelected(referredBy),
                validateSelected(followUpType),
                validateSelected(clinicVisitPlan),
                validateSelected(followUpCategory),
                validateSelected(missedVisitReason),
                validateSelected(currentMedication),
                validateSelected(enrolled));
        showValidationMessages(errors);
        return $.isEmptyObject(errors);
    }

    document.setupValidationForProvider("$('#encounter\\.provider_id_select').val()","encounter\\.provider_id");


});
</script>

</html>
